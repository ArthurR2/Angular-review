function t(t,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(){return(r=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function n(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r}var i=function(){function r(t,r){this.operator=t,this.value=r,Object.defineProperty(this,"t",{writable:!0})}var n,i,e;return r.prototype.addNote=function(t){this.t=this.t||[],this.t.push(t)},n=r,(i=[{key:"notes",get:function(){return this.t}}])&&t(n.prototype,i),e&&t(n,e),r}(),e=function(t){function r(){return t.apply(this,arguments)||this}return n(r,t),r}(i),o=function(t){function r(r,n){if(!Array.isArray(n))throw new Error('"'+r+'" operator expects to receive an array of conditions');return t.call(this,r,n)||this}return n(r,t),r}(e),u="__itself__",f=function(t){function r(r,n,i){var e;return(e=t.call(this,r,i)||this).field=n,e}return n(r,t),r}(i),a=new e("__null__",null);function c(t,r){var n=t[r];if("function"!=typeof n)throw new Error('Unable to interpret "'+r+'" condition. Did you forget to register interpreter for it?');return n}function s(t){return t.operator}function h(t,n){var i,e=n,o=e&&e.getInterpreterName||s;switch(e?e.numberOfArguments:0){case 1:i=function(r){var n=o(r,e);return c(t,n)(r,u)};break;case 3:i=function(r,n,i){var f=o(r,e);return c(t,f)(r,n,i,u)};break;default:i=function(r,n){var i=o(r,e);return c(t,i)(r,n,u)}}var u=r({},e,{interpret:i});return u.interpret}function v(t,r){return function(n){for(var i=arguments.length,e=new Array(i>1?i-1:0),o=1;o<i;o++)e[o-1]=arguments[o];var u=t.apply(void 0,[n].concat(e)),f=r.bind(null,u);return f.ast=u,f}}function d(t,r){return r instanceof o&&r.operator===t}function p(t,r){return 1===r.length?r[0]:new o(t,function t(r,n,i){for(var e=i||[],o=0,u=n.length;o<u;o++){var f=n[o];d(r,f)?t(r,f.value,e):e.push(f)}return e}(t,r))}var l=function(t){return t};function w(t,r){if(!t||t&&t.constructor!==Object)return!1;for(var n in t)if(t.hasOwnProperty(n)&&r.hasOwnProperty(n))return!0;return!1}var b=function(){return Object.create(null)},y=function(t){return p("and",t)},O=function(t){return p("or",t)},j={compound:function(t,r,n){var i=(Array.isArray(r)?r:[r]).map((function(t){return n.parse(t)}));return new o(t.name,i)},field:function(t,r,n){return new f(t.name,n.field,r)},document:function(t,r){return new e(t.name,r)}};function m(t,r,n){return"function"==typeof t.validate&&t.validate(t,r),(t.parse||j[t.type])(t,r,n)}var _=function(){function t(t,n){var i=this;void 0===n&&(n=b()),this.i=void 0,this.o=void 0,this.u=void 0,this.s=void 0,this.parse=this.parse.bind(this),this.s={operatorToConditionName:n.operatorToConditionName||l,defaultOperatorName:n.defaultOperatorName||"eq"},this.i=Object.keys(t).reduce((function(n,e){return n[e]=r({name:i.s.operatorToConditionName(e)},t[e]),n}),{}),this.o=r({},n.fieldContext,{field:"",query:{},parse:this.parse,hasOperators:function(t){return w(t,i.i)}}),this.u=r({},n.documentContext,{parse:this.parse,query:{}})}var n=t.prototype;return n.setParse=function(t){this.parse=t,this.o.parse=t,this.u.parse=t},n.parseField=function(t,r,n,i){var e=this.i[r];if(!e)throw new Error('Unsupported operator "'+r+'"');if("field"!==e.type)throw new Error("Unexpected "+e.type+' operator "'+r+'" at field level');return this.o.field=t,this.o.query=i,m(e,n,this.o)},n.parseFieldOperators=function(t,r){for(var n=[],i=Object.keys(r),e=0,o=i.length;e<o;e++){var u=i[e];if(!this.i[u])throw new Error('Field query for "'+t+'" may contain only operators or a plain object as a value');var f=this.parseField(t,u,r[u],r);f!==a&&n.push(f)}return n},n.parse=function(t){var r=[],n=Object.keys(t);this.u.query=t;for(var i=0,e=n.length;i<e;i++){var o=n[i],u=t[o],f=this.i[o];if(f){if("document"!==f.type&&"compound"!==f.type)throw new Error('Cannot use parsing instruction for operator "'+o+'" in "document" context as it is supposed to be used in  "'+f.type+'" context');r.push(m(f,u,this.u))}else w(u,this.i)?r.push.apply(r,this.parseFieldOperators(o,u)):r.push(this.parseField(o,this.s.defaultOperatorName,u,t))}return y(r)},t}();export{o as CompoundCondition,i as Condition,e as DocumentCondition,f as FieldCondition,u as ITSELF,a as NULL_CONDITION,_ as ObjectQueryParser,y as buildAnd,O as buildOr,h as createInterpreter,v as createTranslatorFactory,j as defaultInstructionParsers,w as hasOperators,l as identity,d as isCompound,b as object,p as optimizedCompoundCondition,m as parseInstruction};
//# sourceMappingURL=index.js.map
