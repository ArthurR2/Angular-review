!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(((t=t||self).ucast=t.ucast||{},t.ucast.core={}))}(this,(function(t){"use strict";function r(t,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function n(){return(n=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function e(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r}var i=function(){function t(t,r){this.operator=t,this.value=r,Object.defineProperty(this,"t",{writable:!0})}var n,e,i;return t.prototype.addNote=function(t){this.t=this.t||[],this.t.push(t)},n=t,(e=[{key:"notes",get:function(){return this.t}}])&&r(n.prototype,e),i&&r(n,i),t}(),o=function(t){function r(){return t.apply(this,arguments)||this}return e(r,t),r}(i),u=function(t){function r(r,n){if(!Array.isArray(n))throw new Error('"'+r+'" operator expects to receive an array of conditions');return t.call(this,r,n)||this}return e(r,t),r}(o),f=function(t){function r(r,n,e){var i;return(i=t.call(this,r,e)||this).field=n,i}return e(r,t),r}(i),c=new o("__null__",null);function s(t,r){var n=t[r];if("function"!=typeof n)throw new Error('Unable to interpret "'+r+'" condition. Did you forget to register interpreter for it?');return n}function a(t){return t.operator}function h(t,r){return r instanceof u&&r.operator===t}function v(t,r){return 1===r.length?r[0]:new u(t,function t(r,n,e){for(var i=e||[],o=0,u=n.length;o<u;o++){var f=n[o];h(r,f)?t(r,f.value,i):i.push(f)}return i}(t,r))}var d=function(t){return t};function p(t,r){if(!t||t&&t.constructor!==Object)return!1;for(var n in t)if(t.hasOwnProperty(n)&&r.hasOwnProperty(n))return!0;return!1}var l=function(){return Object.create(null)},w=function(t){return v("and",t)},b={compound:function(t,r,n){var e=(Array.isArray(r)?r:[r]).map((function(t){return n.parse(t)}));return new u(t.name,e)},field:function(t,r,n){return new f(t.name,n.field,r)},document:function(t,r){return new o(t.name,r)}};function y(t,r,n){return"function"==typeof t.validate&&t.validate(t,r),(t.parse||b[t.type])(t,r,n)}var j=function(){function t(t,r){var e=this;void 0===r&&(r=l()),this.i=void 0,this.o=void 0,this.u=void 0,this.s=void 0,this.parse=this.parse.bind(this),this.s={operatorToConditionName:r.operatorToConditionName||d,defaultOperatorName:r.defaultOperatorName||"eq"},this.i=Object.keys(t).reduce((function(r,i){return r[i]=n({name:e.s.operatorToConditionName(i)},t[i]),r}),{}),this.o=n({},r.fieldContext,{field:"",query:{},parse:this.parse,hasOperators:function(t){return p(t,e.i)}}),this.u=n({},r.documentContext,{parse:this.parse,query:{}})}var r=t.prototype;return r.setParse=function(t){this.parse=t,this.o.parse=t,this.u.parse=t},r.parseField=function(t,r,n,e){var i=this.i[r];if(!i)throw new Error('Unsupported operator "'+r+'"');if("field"!==i.type)throw new Error("Unexpected "+i.type+' operator "'+r+'" at field level');return this.o.field=t,this.o.query=e,y(i,n,this.o)},r.parseFieldOperators=function(t,r){for(var n=[],e=Object.keys(r),i=0,o=e.length;i<o;i++){var u=e[i];if(!this.i[u])throw new Error('Field query for "'+t+'" may contain only operators or a plain object as a value');var f=this.parseField(t,u,r[u],r);f!==c&&n.push(f)}return n},r.parse=function(t){var r=[],n=Object.keys(t);this.u.query=t;for(var e=0,i=n.length;e<i;e++){var o=n[e],u=t[o],f=this.i[o];if(f){if("document"!==f.type&&"compound"!==f.type)throw new Error('Cannot use parsing instruction for operator "'+o+'" in "document" context as it is supposed to be used in  "'+f.type+'" context');r.push(y(f,u,this.u))}else p(u,this.i)?r.push.apply(r,this.parseFieldOperators(o,u)):r.push(this.parseField(o,this.s.defaultOperatorName,u,t))}return w(r)},t}();t.CompoundCondition=u,t.Condition=i,t.DocumentCondition=o,t.FieldCondition=f,t.ITSELF="__itself__",t.NULL_CONDITION=c,t.ObjectQueryParser=j,t.buildAnd=w,t.buildOr=function(t){return v("or",t)},t.createInterpreter=function(t,r){var e,i=r,o=i&&i.getInterpreterName||a;switch(i?i.numberOfArguments:0){case 1:e=function(r){var n=o(r,i);return s(t,n)(r,u)};break;case 3:e=function(r,n,e){var f=o(r,i);return s(t,f)(r,n,e,u)};break;default:e=function(r,n){var e=o(r,i);return s(t,e)(r,n,u)}}var u=n({},i,{interpret:e});return u.interpret},t.createTranslatorFactory=function(t,r){return function(n){for(var e=arguments.length,i=new Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];var u=t.apply(void 0,[n].concat(i)),f=r.bind(null,u);return f.ast=u,f}},t.defaultInstructionParsers=b,t.hasOperators=p,t.identity=d,t.isCompound=h,t.object=l,t.optimizedCompoundCondition=v,t.parseInstruction=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
